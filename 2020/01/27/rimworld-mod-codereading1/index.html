<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="开篇闲扯Rimworld 有一个逼死强迫症的设定就是，小人的技能升级过高之后会导致技能随着时间自然流失。于是就有了一个叫做 Mad Skills 的创意工坊 MOD。创意工坊连接  涉及 C# 代码，采用 Harmony 注入 代码量很小 改变了游戏中的一些行为（指定经验值流失速率等，而这个在代码里面而不是能通过 XML 文件修改），有必要和其他那种修改数值，照着模子添加新的物品的 MOD 区分开">
<meta property="og:type" content="article">
<meta property="og:title" content="Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)">
<meta property="og:url" content="https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/index.html">
<meta property="og:site_name" content="Weaver_zhu&#39;s blog">
<meta property="og:description" content="开篇闲扯Rimworld 有一个逼死强迫症的设定就是，小人的技能升级过高之后会导致技能随着时间自然流失。于是就有了一个叫做 Mad Skills 的创意工坊 MOD。创意工坊连接  涉及 C# 代码，采用 Harmony 注入 代码量很小 改变了游戏中的一些行为（指定经验值流失速率等，而这个在代码里面而不是能通过 XML 文件修改），有必要和其他那种修改数值，照着模子添加新的物品的 MOD 区分开">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-01-27T11:54:43.000Z">
<meta property="article:modified_time" content="2022-09-05T23:33:10.107Z">
<meta property="article:author" content="Weave_zhu">
<meta property="article:tag" content="Rimworld">
<meta property="article:tag" content="Mod">
<meta property="article:tag" content="环世界">
<meta property="article:tag" content="Mod 教程">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" "Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/project/">项目</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/categories/">分类</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇 " href="/2020/02/12/burnside-polya/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇 " href="/2020/01/26/tarjan/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部 " href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章 " href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/&text=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/&title=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/&is_video=false&description=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)&body=Check out this article: https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/&title=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/&title=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/&title=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/&title=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/&name=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/&t=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E7%AF%87%E9%97%B2%E6%89%AF"><span class="toc-number">1.</span> <span class="toc-text">开篇闲扯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%B2%E6%89%AF%EF%BC%88%E7%BB%AD%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">闲扯（续）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%B0%86%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BB%A3%E7%A0%81%E6%94%BE%E5%88%B0%E6%B8%B8%E6%88%8F%E4%B8%AD%EF%BC%9F"><span class="toc-number">3.</span> <span class="toc-text">如何将自己的代码放到游戏中？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Harmony"><span class="toc-number">3.1.</span> <span class="toc-text">Harmony</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3%E6%B8%B8%E6%88%8F%E7%9A%84%E4%BB%A3%E7%A0%81%E9%80%BB%E8%BE%91"><span class="toc-number">4.</span> <span class="toc-text">了解游戏的代码逻辑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-Mod-cs"><span class="toc-number">5.</span> <span class="toc-text">Code: Mod.cs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-ModSettings-cs"><span class="toc-number">6.</span> <span class="toc-text">Code: ModSettings.cs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-Patch-LearningSaturation-cs"><span class="toc-number">7.</span> <span class="toc-text">Code: Patch_LearningSaturation.cs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-Patch-LearningSaturationUI-cs"><span class="toc-number">8.</span> <span class="toc-text">Code: Patch_LearningSaturationUI.cs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-Patch-SkillRecordInterval-cs"><span class="toc-number">9.</span> <span class="toc-text">Code: Patch_SkillRecordInterval.cs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-End"><span class="toc-number">10.</span> <span class="toc-text">The End</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Weave_zhu</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-01-27T11:54:43.000Z" itemprop="datePublished">2020-01-27</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/Game-Mods/">Game Mods</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/Mod/" rel="tag">Mod</a>, <a class="tag-link-link" href="/tags/Mod-%E6%95%99%E7%A8%8B/" rel="tag">Mod 教程</a>, <a class="tag-link-link" href="/tags/Rimworld/" rel="tag">Rimworld</a>, <a class="tag-link-link" href="/tags/%E7%8E%AF%E4%B8%96%E7%95%8C/" rel="tag">环世界</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="开篇闲扯"><a href="#开篇闲扯" class="headerlink" title="开篇闲扯"></a>开篇闲扯</h2><p>Rimworld 有一个逼死强迫症的设定就是，小人的技能升级过高之后会导致技能随着时间自然流失。于是就有了一个叫做 <a target="_blank" rel="noopener" href="https://github.com/Ratysz/MadSkills">Mad Skills</a> 的创意工坊 MOD。<a target="_blank" rel="noopener" href="https://steamcommunity.com/sharedfiles/filedetails/?id=731111514&searchtext=mad+skills">创意工坊连接</a></p>
<ul>
<li>涉及 C# 代码，采用 <a target="_blank" rel="noopener" href="https://harmony.pardeike.net/">Harmony</a> 注入</li>
<li>代码量很小</li>
<li>改变了游戏中的一些行为（指定经验值流失速率等，而这个在代码里面而不是能通过 XML 文件修改），有必要和其他那种修改数值，照着模子添加新的物品的 MOD 区分开来</li>
</ul>
<p>所以这里解读 MOD 的代码，顺便做一个 Rimworld 代码 MOD 制作向导（不算是教程，因为大多数内容是官方 Wiki 和论坛上已经有了的</p>
<ul>
<li>推荐阅读：<ul>
<li><a target="_blank" rel="noopener" href="https://rimworldwiki.com/wiki/Modding_Tutorials#XML_tutorials">Rimworld Wiki</a></li>
<li><a target="_blank" rel="noopener" href="https://ludeon.com/forums/">Rimworld offical forum</a></li>
</ul>
</li>
<li>很多地方只是给出一个上述网站的链接，毕竟做一个写代码的 MOD 涉及的东西还是很多的，已经有的很好的教程就不翻译复制一遍了</li>
</ul>
<h2 id="闲扯（续）"><a href="#闲扯（续）" class="headerlink" title="闲扯（续）"></a>闲扯（续）</h2><p>极其不严谨而又粗略的说，Rimworld 先从 XML 中获取各种东西的定义和属性（比如子弹伤害，建筑建造成本等）。先加载一个叫做 Core 的 MOD，然后再加载其他内容，遇到相同的标签就覆盖（MOD做的事情就是替换原来的东西，用相同标签替换只是修改 XML 的其中一种方法）。当然，仅仅在 XML 上下功夫可能满足不了我们，比如修改游戏中的行为逻辑。调整人物的学习速率就是其中的一个，肯定需要修改代码。这个 MOD 可以作为一个代码 MOD 的范例</p>
<h2 id="如何将自己的代码放到游戏中？"><a href="#如何将自己的代码放到游戏中？" class="headerlink" title="如何将自己的代码放到游戏中？"></a>如何将自己的代码放到游戏中？</h2><p>大致的流程如下：</p>
<ol>
<li> 大致了解 <a target="_blank" rel="noopener" href="https://rimworldwiki.com/wiki/Modding_Tutorials/Mod_folder_structure">MOD 文件结构</a></li>
<li>大致了解 <a target="_blank" rel="noopener" href="https://rimworldwiki.com/wiki/Modding_Tutorials#C.23_tutorials">在 Rimworld 中写 C#</a>，涉及到的内容有<ol>
<li> Setting up</li>
<li> Hello World，做一个最基本的 MOD</li>
<li> Decompiling Source Code，推荐使用 <a target="_blank" rel="noopener" href="https://github.com/icsharpcode/ILSpy">ILSpy</a></li>
<li> Writing Custom Code</li>
<li> Alter Code at Runtime with Harmony</li>
<li> Plague Gun (可选) 主要是增加一个武器（类似于用老武器的东西继承过来创建一个新的武器，基本上不需要有新的行为）</li>
</ol>
</li>
</ol>
<p><code>Verse</code> 命名空间中提供了供继承的 <code>Mod</code> 类和 <code>Modsetting</code> 类，这样的话玩家可以修改 Mod 的设定</p>
<p>具体请看 <a target="_blank" rel="noopener" href="https://rimworldwiki.com/wiki/Modding_Tutorials/ModSettings">Modding Tutorials/ModSettings</a></p>
<h3 id="Harmony"><a href="#Harmony" class="headerlink" title="Harmony"></a>Harmony</h3><p>面对一个几千个 <code>.cs</code> 文件的东西要添加代码是一件很迷茫的事情，而且注意到游戏当然是编译好的，我们的代码作为类库编译成 <code>assembly</code> 交给游戏的。我们需要一个工具帮我们处理一切杂事，使得我们只需要提供代码就行了。</p>
<p>Wiki 明确指出不应该使用任何其他的注入等骚操作，而 <code>Harmony</code> 这玩意的思路是：比如说你想要修改一个方法，你要准备一个具有 <code>HarmonyPatch</code> 属性的类，它指定了要修改的类和方法（这些信息在属性里面），然后准备两个成员方法，它们的参数包括修改的方法的所有参数和返回值的 <code>ref</code> 版本（也就是说可以自由改变参数和返回值</p>
<ol>
<li> <code>prefix</code> 方法，在调用原方法之前的方法，可以返回 <code>void</code> 或者 <code>bool</code>。如果是 <code>bool</code> 返回 <code>false</code> 便不会执行原方法，相当于用 <code>prefix</code> 替换了原方法</li>
<li> <code>postfix</code> 方法，在调用原方法之后的方法。即使 <code>prefix</code> 返回 false 也会执行</li>
</ol>
<p>之后你需要使用 <code>PatchAll</code> 提交你的修改，这个操作在你的 <code>Mod</code> 类的构造函数中执行最适合不过了（加载 Mod 的时候</p>
<p>具体的看 <a target="_blank" rel="noopener" href="https://harmony.pardeike.net/articles/intro.html">Harmony 文档</a></p>
<p>事实上 <code>Harmony</code> 最初是专门用来做 Rimworld Mod 的工具。工具甚至能处理 MOD 冲突（不知道能不能拿它去搞太吾绘卷</p>
<h2 id="了解游戏的代码逻辑"><a href="#了解游戏的代码逻辑" class="headerlink" title="了解游戏的代码逻辑"></a>了解游戏的代码逻辑</h2><p>该反编译工具上场了，请确保已经阅读了这篇 <a target="_blank" rel="noopener" href="https://rimworldwiki.com/wiki/Modding_Tutorials/Decompiling_source_code">Modding Tutorials/Decompiling source code</a></p>
<p>实际上 MOD 有一下功能：</p>
<ol>
<li> 指定经验流失速度</li>
<li> 可以设置每天学习经验上限并指定超出</li>
<li> 额外添加 Great Memory 技能（原指降低一半的经验值流失速度）的一个效果：增加学习速度 25%</li>
</ol>
<p>加入自己来做这个东西的 MOD，你需要找到写这个逻辑的地方。你应该怎么找呢？</p>
<ol>
<li>从文件名推断，寻找含有 <code>Skill</code> 名字的 <code>.cs</code> 文件</li>
<li>从 XML 中寻找，XML 文件中各种 Def 的属性，然后搜索对应的属性名字找到相关代码。使用 vscode 的 <code>ctrl+shift+f</code> 可以支持在当前目录种多文件寻找</li>
</ol>
<h2 id="Code-Mod-cs"><a href="#Code-Mod-cs" class="headerlink" title="Code: Mod.cs"></a>Code: Mod.cs</h2><p>首先是 Mod 被加载的时候使用，<code>SettingsCategory</code> 和 <code>DoSetingsWindowContents</code> 用于 Mod 设置。创建 <code>Harmony</code> 类，然后 <code>PatchAll</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Mod</span> : <span class="title">Verse.Mod</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> ModSettings settings;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Mod</span>(<span class="params">ModContentPack content</span>) : <span class="title">base</span>(<span class="params">content</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">var</span> harmony = HarmonyInstance.Create(<span class="string">&quot;io.github.ratysz.madskills&quot;</span>);</span><br><span class="line">        harmony.PatchAll(Assembly.GetExecutingAssembly());</span><br><span class="line"></span><br><span class="line">        settings = GetSettings&lt;ModSettings&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">SettingsCategory</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> settings.SettingsCategory();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">DoSettingsWindowContents</span>(<span class="params">Rect inRect</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        settings.DoSettingsWindowContents(inRect);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Code-ModSettings-cs"><a href="#Code-ModSettings-cs" class="headerlink" title="Code: ModSettings.cs"></a>Code: ModSettings.cs</h2><p>首先是修改 Great Memory 技能的功能，我们找到游戏代码中的 <code>DefGenerator</code>，这个静态类用于生成游戏中各种东西的定义，当然包括了技能的定义。我们要做的就是在 Great Memory 的定义生成之后再改变它的功能，写一个 <code>postfix</code> 函数</p>
<p>由于原技能 Great Memory 的属性在 XML 文件中，我们需要 <code>DefDatabase</code> 获得这些信息。 Refer to this <a target="_blank" rel="noopener" href="https://rimworldwiki.com/wiki/Modding_Tutorials/Linking_XML_and_C">Modding_Tutorials/Linking_XML_and_C</a></p>
<p>经过耐心的搜索，发现加载 Def 位于 <code>Rimworld.DefGenerator</code>。再次提一下：</p>
<ol>
<li> 从文件名，方法名，变量名查找灵感，也可以从 XML 文件（位于 <code>Mods/Core/</code>）的属性得到类型名称。比如说在这个问题中你是不是想找找看 <code>DefDatabase</code> 哪里搞来的数据？在所有文件中寻找 <code>DefDatabase.Add</code> 试试看！</li>
<li> 从别人的 MOD 代码学习，如果这个 MOD 能做 A… 我是不是就可以做 B…</li>
<li> 不要尝试搞懂所有的东西，如果你想找技能数据加载的地方，就不用把整个游戏的代码都理解下来</li>
</ol>
<p>搜索 GreatMemory，结合 XML 看一看 <code>Traits_Singular.xml</code> </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TraitDef</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">defName</span>&gt;</span>GreatMemory<span class="tag">&lt;/<span class="name">defName</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">commonality</span>&gt;</span>1.1<span class="tag">&lt;/<span class="name">commonality</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">degreeDatas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>great memory<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">description</span>&gt;</span>&#123;PAWN_nameDef&#125; has a fantastic memory for detail. &#123;PAWN_pronoun&#125; will lose unused skills at half the rate of other people.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">degreeDatas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">TraitDef</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>包含了技能的介绍信息，这里肯定也要改</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">RTMadSkills</span></span><br><span class="line">&#123;</span><br><span class="line">	[<span class="meta">HarmonyPatch(typeof(DefGenerator))</span>]</span><br><span class="line">	[<span class="meta">HarmonyPatch(<span class="meta-string">&quot;GenerateImpliedDefs_PostResolve&quot;</span>)</span>]</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ModSettingsDefJockey</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">static</span> FieldInfo greatMemoryDegreeDatasField = AccessTools.Field(<span class="keyword">typeof</span>(TraitDef), <span class="string">&quot;degreeDatas&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">bool</span> valid = <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">static</span> TraitDef greatMemory = <span class="literal">null</span>;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">static</span> List&lt;TraitDegreeData&gt; greatMemoryDegreeDatasBackup = <span class="literal">null</span>;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">static</span> List&lt;TraitDegreeData&gt; greatMemoryDegreeDatasNew = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Postfix</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			<span class="keyword">if</span> (!valid)</span><br><span class="line">			&#123;</span><br><span class="line">				greatMemory = DefDatabase&lt;TraitDef&gt;.GetNamed(<span class="string">&quot;GreatMemory&quot;</span>);</span><br><span class="line">				greatMemoryDegreeDatasBackup = (List&lt;TraitDegreeData&gt;)greatMemoryDegreeDatasField.GetValue(greatMemory);</span><br><span class="line"></span><br><span class="line">				StatModifier modifier = <span class="keyword">new</span> StatModifier();</span><br><span class="line">				modifier.stat = DefDatabase&lt;StatDef&gt;.GetNamed(<span class="string">&quot;GlobalLearningFactor&quot;</span>);</span><br><span class="line">				modifier.<span class="keyword">value</span> = <span class="number">0.25f</span>;</span><br><span class="line">				TraitDegreeData data = <span class="keyword">new</span> TraitDegreeData();</span><br><span class="line">				data.statOffsets = <span class="keyword">new</span> List&lt;StatModifier&gt;</span><br><span class="line">				&#123;</span><br><span class="line">					modifier</span><br><span class="line">				&#125;;</span><br><span class="line">				data.label = greatMemoryDegreeDatasBackup[<span class="number">0</span>].label;</span><br><span class="line">				data.description = <span class="string">&quot;MadSkills_AlternativeGreatMemoryDescription&quot;</span>.Translate();</span><br><span class="line">				greatMemoryDegreeDatasNew = <span class="keyword">new</span> List&lt;TraitDegreeData&gt;</span><br><span class="line">				&#123;</span><br><span class="line">					data</span><br><span class="line">				&#125;;</span><br><span class="line"></span><br><span class="line">				valid = <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			ApplyChanges(ModSettings.greatMemoryAltered);</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ApplyChanges</span>(<span class="params"><span class="built_in">bool</span> altered</span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			<span class="keyword">if</span> (valid)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (altered)</span><br><span class="line">				&#123;</span><br><span class="line">					greatMemory.degreeDatas = greatMemoryDegreeDatasNew;</span><br><span class="line">					Log.Message(<span class="string">&quot;[MadSkills]: changed behavior of Great Memory trait.&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					greatMemory.degreeDatas = greatMemoryDegreeDatasBackup;</span><br><span class="line">					Log.Message(<span class="string">&quot;[MadSkills]: restored behavior of Great Memory trait.&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>保存原来的数据，然后为新的 <code>degreedata</code> 添加一个 25% 的学习速率加成。哪里能改全局学习速率？XML 中没有数据，但是找到 XML 中对于 <code>FastLearner</code>：</p>
<p>这说明我们要在 <code>degreeData</code> 里面依照 Fast Learner 添加相同的效果就行了。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TraitDef</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">defName</span>&gt;</span>FastLearner<span class="tag">&lt;/<span class="name">defName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">degreeDatas</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span>&gt;</span>fast learner<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">description</span>&gt;</span>&#123;PAWN_nameDef&#125; has a knack for learning. &#123;PAWN_pronoun&#125; picks things up much faster than others.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">statOffsets</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">GlobalLearningFactor</span>&gt;</span>0.75<span class="tag">&lt;/<span class="name">GlobalLearningFactor</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">statOffsets</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">degreeDatas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">TraitDef</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>发现有 <code>GlobalLearningFactor</code> 这个属性名字，go for it。找到 <code>SkillRecord.cs</code> 和 <code>StatDefOf.cs</code> 两个文件，你发现了更加令人激动的东西，<code>SkillRecord</code> 有很多有用的信息比如 <code>xpSinceMidnight</code> 定义了每天学习的 xp 用于判断是否达到上限，<code>LearnRateFactor</code> 描述了各种学习速率.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Pawn pawn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> SkillDef def;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> levelInt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Passion passion;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">float</span> xpSinceLastLevel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">float</span> xpSinceMidnight;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> BoolUnknown cachedTotallyDisabled = BoolUnknown.Unknown;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">int</span> IntervalTicks = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">int</span> MinLevel = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">int</span> MaxLevel = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">int</span> MaxFullRateXpPerDay = <span class="number">4000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">int</span> MasterSkillThreshold = <span class="number">14</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">float</span> SaturatedLearningFactor = <span class="number">0.2f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">float</span> LearnFactorPassionNone = <span class="number">0.35f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">float</span> LearnFactorPassionMinor = <span class="number">1f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">float</span> LearnFactorPassionMajor = <span class="number">1.5f</span>;</span><br><span class="line"><span class="comment">// ... other code</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">float</span> <span class="title">LearnRateFactor</span>(<span class="params"><span class="built_in">bool</span> direct = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (DebugSettings.fastLearning)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">200f</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">float</span> num;</span><br><span class="line">	<span class="keyword">switch</span> (passion)</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> Passion.None:</span><br><span class="line">		num = <span class="number">0.35f</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> Passion.Minor:</span><br><span class="line">		num = <span class="number">1f</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> Passion.Major:</span><br><span class="line">		num = <span class="number">1.5f</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="literal">default</span>:</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> NotImplementedException(<span class="string">&quot;Passion level &quot;</span> + passion);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!direct)</span><br><span class="line">	&#123;</span><br><span class="line">		num *= pawn.GetStatValue(StatDefOf.GlobalLearningFactor);</span><br><span class="line">		<span class="keyword">if</span> (LearningSaturatedToday)</span><br><span class="line">		&#123;</span><br><span class="line">			num *= <span class="number">0.2f</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Interval</code> 定义了经验值流失速率</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Interval</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">float</span> num = (!pawn.story.traits.HasTrait(TraitDefOf.GreatMemory)) ? <span class="number">1f</span> : <span class="number">0.5f</span>;</span><br><span class="line">	<span class="keyword">switch</span> (levelInt)</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">		Learn(<span class="number">-0.1f</span> * num);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">		Learn(<span class="number">-0.2f</span> * num);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">		Learn(<span class="number">-0.4f</span> * num);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">13</span>:</span><br><span class="line">		Learn(<span class="number">-0.6f</span> * num);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">14</span>:</span><br><span class="line">		Learn(<span class="number">-1f</span> * num);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">15</span>:</span><br><span class="line">		Learn(<span class="number">-1.8f</span> * num);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">		Learn(<span class="number">-2.8f</span> * num);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">17</span>:</span><br><span class="line">		Learn(<span class="number">-4f</span> * num);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">18</span>:</span><br><span class="line">		Learn(<span class="number">-6f</span> * num);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">19</span>:</span><br><span class="line">		Learn(<span class="number">-8f</span> * num);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">20</span>:</span><br><span class="line">		Learn(<span class="number">-12f</span> * num);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Gotta！就决定 Patch 这两个函数了。同时在 <code>StatDefOf.cs</code> 里面发现了 <code>GlobalLearningFactor</code> 的类型</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> StatDef FoodPoisonChanceFixedHuman;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> StatDef MoveSpeed;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> StatDef GlobalLearningFactor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> StatDef HungerRateMultiplier;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> StatDef RestRateMultiplier;</span><br></pre></td></tr></table></figure>

<p>搜索 <code>degreedata</code>，发现 <code>TraitDegreeData.cs</code> 中有 <code>statOffsets</code> 的描述。好了，你应该知道代码是怎么修改 Great Memory 为增加 25% 学习速率了吧？</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[MustTranslate]</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> label;</span><br><span class="line"></span><br><span class="line"><span class="string">[Unsaved]</span></span><br><span class="line"><span class="string">[TranslationHandle]</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> untranslatedLabel;</span><br><span class="line"></span><br><span class="line"><span class="string">[MustTranslate]</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> description;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> degree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">float</span> commonality = <span class="number">1f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List&lt;StatModifier&gt; statOffsets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List&lt;StatModifier&gt; statFactors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> ThinkTreeDef thinkTree;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>同时加上描述信息。想要不同语言？Refer to this: <a target="_blank" rel="noopener" href="https://rimworldwiki.com/wiki/Plague_Gun/Localisation">Plague_Gun/Localisation</a></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ModSettings</span> : <span class="title">Verse.ModSettings</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">bool</span> tiered = <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">bool</span> greatMemoryAltered = <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> multiplierPercentage = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">float</span> multiplier</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">get</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">return</span> multiplierPercentage / <span class="number">100.0f</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">set</span></span><br><span class="line">			&#123;</span><br><span class="line">				multiplierPercentage = Mathf.RoundToInt(multiplier * <span class="number">100</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">float</span> dailyXPSaturationThreshold = <span class="number">4000.0f</span>;</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">float</span> saturatedXPMultiplier</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">get</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">return</span> saturatedXPmultiplierPercentage / <span class="number">100.0f</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">set</span></span><br><span class="line">			&#123;</span><br><span class="line">				saturatedXPmultiplierPercentage = Mathf.RoundToInt(multiplier * <span class="number">100</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> saturatedXPmultiplierPercentage = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">ExposeData</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			<span class="built_in">float</span> multiplier_shadow = multiplier;</span><br><span class="line">			<span class="built_in">float</span> saturatedXPMultiplier_shadow = saturatedXPMultiplier;</span><br><span class="line">			Scribe_Values.Look(<span class="keyword">ref</span> tiered, <span class="string">&quot;tiered&quot;</span>);</span><br><span class="line">			Scribe_Values.Look(<span class="keyword">ref</span> greatMemoryAltered, <span class="string">&quot;greatMemoryAltered&quot;</span>);</span><br><span class="line">			Scribe_Values.Look(<span class="keyword">ref</span> multiplier_shadow, <span class="string">&quot;multiplier&quot;</span>);</span><br><span class="line">			Scribe_Values.Look(<span class="keyword">ref</span> dailyXPSaturationThreshold, <span class="string">&quot;dailyXPSaturationThreshold&quot;</span>);</span><br><span class="line">			Scribe_Values.Look(<span class="keyword">ref</span> saturatedXPMultiplier_shadow, <span class="string">&quot;saturatedXPMultiplier&quot;</span>);</span><br><span class="line">			Log.Message(<span class="string">&quot;[MadSkills]: settings initialized, multiplier is &quot;</span> + multiplier_shadow</span><br><span class="line">				+ <span class="string">&quot;, &quot;</span> + (tiered ? <span class="string">&quot;tiered&quot;</span> : <span class="string">&quot;not tiered&quot;</span>)</span><br><span class="line">				+ <span class="string">&quot;, daily XP threshold is &quot;</span> + dailyXPSaturationThreshold</span><br><span class="line">				+ <span class="string">&quot;, saturated XP multiplier is &quot;</span> + saturatedXPMultiplier</span><br><span class="line">				+ <span class="string">&quot;, Great Memory trait is &quot;</span> + (greatMemoryAltered ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;not &quot;</span>) + <span class="string">&quot;altered.&quot;</span>);</span><br><span class="line">			ModSettingsDefJockey.ApplyChanges(greatMemoryAltered);</span><br><span class="line">			multiplierPercentage = Mathf.RoundToInt(multiplier_shadow * <span class="number">100</span>);</span><br><span class="line">			saturatedXPmultiplierPercentage = Mathf.RoundToInt(saturatedXPMultiplier_shadow * <span class="number">100</span>);</span><br><span class="line">			<span class="keyword">base</span>.ExposeData();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">SettingsCategory</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&quot;MadSkills_SettingsCategory&quot;</span>.Translate();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoSettingsWindowContents</span>(<span class="params">Rect rect</span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			Listing_Standard list = <span class="keyword">new</span> Listing_Standard(GameFont.Small);</span><br><span class="line">			list.ColumnWidth = rect.width / <span class="number">3</span>;</span><br><span class="line">			list.Begin(rect);</span><br><span class="line">			list.Gap();</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">string</span> buffer = multiplierPercentage.ToString();</span><br><span class="line">				Rect rectLine = list.GetRect(Text.LineHeight);</span><br><span class="line">				Rect rectLeft = rectLine.LeftHalf().Rounded();</span><br><span class="line">				Rect rectRight = rectLine.RightHalf().Rounded();</span><br><span class="line">				Rect rectPercent = rectRight.RightPartPixels(Text.LineHeight);</span><br><span class="line">				rectRight = rectRight.LeftPartPixels(rectRight.width - Text.LineHeight);</span><br><span class="line">				Widgets.DrawHighlightIfMouseover(rectLine);</span><br><span class="line">				TooltipHandler.TipRegion(rectLine, <span class="string">&quot;MadSkills_MultiplierTip&quot;</span>.Translate());</span><br><span class="line">				TextAnchor anchorBuffer = Text.Anchor;</span><br><span class="line">				Text.Anchor = TextAnchor.MiddleLeft;</span><br><span class="line">				Widgets.Label(rectLeft, <span class="string">&quot;MadSkills_MultiplierLabel&quot;</span>.Translate());</span><br><span class="line">				Text.Anchor = anchorBuffer;</span><br><span class="line">				Widgets.TextFieldNumeric(rectRight, <span class="keyword">ref</span> multiplierPercentage, <span class="keyword">ref</span> buffer, <span class="number">0</span>, <span class="number">10000</span>);</span><br><span class="line">				Widgets.Label(rectPercent, <span class="string">&quot;%&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			list.CheckboxLabeled(</span><br><span class="line">				<span class="string">&quot;MadSkills_TieredLabel&quot;</span>.Translate(),</span><br><span class="line">				<span class="keyword">ref</span> tiered,</span><br><span class="line">				<span class="string">&quot;MadSkills_TieredTip&quot;</span>.Translate());</span><br><span class="line">			list.CheckboxLabeled(</span><br><span class="line">				<span class="string">&quot;MadSkills_AlterGreatMemoryLabel&quot;</span>.Translate(),</span><br><span class="line">				<span class="keyword">ref</span> greatMemoryAltered,</span><br><span class="line">				<span class="string">&quot;MadSkills_AlterGreatMemoryTip&quot;</span>.Translate());</span><br><span class="line">			list.Gap();</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">string</span> buffer = dailyXPSaturationThreshold.ToString();</span><br><span class="line">				Rect rectLine = list.GetRect(Text.LineHeight);</span><br><span class="line">				Rect rectLeft = rectLine.LeftHalf().Rounded();</span><br><span class="line">				Rect rectRight = rectLine.RightHalf().Rounded();</span><br><span class="line">				Widgets.DrawHighlightIfMouseover(rectLine);</span><br><span class="line">				TooltipHandler.TipRegion(rectLine, <span class="string">&quot;MadSkills_DailyXPSaturationThresholdTip&quot;</span>.Translate());</span><br><span class="line">				TextAnchor anchorBuffer = Text.Anchor;</span><br><span class="line">				Text.Anchor = TextAnchor.MiddleLeft;</span><br><span class="line">				Widgets.Label(rectLeft, <span class="string">&quot;MadSkills_DailyXPSaturationThresholdLabel&quot;</span>.Translate());</span><br><span class="line">				Text.Anchor = anchorBuffer;</span><br><span class="line">				Widgets.TextFieldNumeric(rectRight, <span class="keyword">ref</span> dailyXPSaturationThreshold, <span class="keyword">ref</span> buffer, <span class="number">0</span>, <span class="number">100000</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">string</span> buffer = saturatedXPmultiplierPercentage.ToString();</span><br><span class="line">				Rect rectLine = list.GetRect(Text.LineHeight);</span><br><span class="line">				Rect rectLeft = rectLine.LeftHalf().Rounded();</span><br><span class="line">				Rect rectRight = rectLine.RightHalf().Rounded();</span><br><span class="line">				Rect rectPercent = rectRight.RightPartPixels(Text.LineHeight);</span><br><span class="line">				rectRight = rectRight.LeftPartPixels(rectRight.width - Text.LineHeight);</span><br><span class="line">				Widgets.DrawHighlightIfMouseover(rectLine);</span><br><span class="line">				TooltipHandler.TipRegion(rectLine, <span class="string">&quot;MadSkills_SaturatedXPMultiplierTip&quot;</span>.Translate());</span><br><span class="line">				TextAnchor anchorBuffer = Text.Anchor;</span><br><span class="line">				Text.Anchor = TextAnchor.MiddleLeft;</span><br><span class="line">				Widgets.Label(rectLeft, <span class="string">&quot;MadSkills_SaturatedXPMultiplierLabel&quot;</span>.Translate());</span><br><span class="line">				Text.Anchor = anchorBuffer;</span><br><span class="line">				Widgets.TextFieldNumeric(rectRight, <span class="keyword">ref</span> saturatedXPmultiplierPercentage, <span class="keyword">ref</span> buffer, <span class="number">0</span>, <span class="number">10000</span>);</span><br><span class="line">				Widgets.Label(rectPercent, <span class="string">&quot;%&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			list.End();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这部分主要用于 ModSettings, Refer to this: <a target="_blank" rel="noopener" href="https://rimworldwiki.com/wiki/Modding_Tutorials/ModSettings">Modding Tutorials/ModSettings</a></p>
<p>可以发现默认的每天全速学习上限是 4000，超过之后以 20% 速率学习。然后定义 Mod 设置的东西，包括写入数据 <code>ExposeData</code>，UI 设置 <code>DoSettingsWindowContents</code> 等</p>
<h2 id="Code-Patch-LearningSaturation-cs"><a href="#Code-Patch-LearningSaturation-cs" class="headerlink" title="Code: Patch_LearningSaturation.cs"></a>Code: Patch_LearningSaturation.cs</h2><p>postfix 方法，将原来的学习厌倦逻辑去掉，然后改成自己的。如果要改变不同热情程度对学习效率的影响，你也应该知道该怎么做了吧？</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">HarmonyPatch(typeof(SkillRecord))</span>]</span><br><span class="line">[<span class="meta">HarmonyPatch(<span class="meta-string">&quot;LearnRateFactor&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title">Patch_LearningSaturation</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Postfix</span>(<span class="params">SkillRecord __instance, <span class="keyword">ref</span> <span class="built_in">float</span> __result, <span class="built_in">bool</span> direct = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!direct)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (__instance.LearningSaturatedToday)</span><br><span class="line">            &#123;</span><br><span class="line">                __result /= <span class="number">0.2f</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ModSettings.saturatedXPMultiplier != <span class="number">1.0f</span></span><br><span class="line">                &amp;&amp; __instance.xpSinceMidnight &gt; ModSettings.dailyXPSaturationThreshold)</span><br><span class="line">            &#123;</span><br><span class="line">                __result *= ModSettings.saturatedXPMultiplier;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Code-Patch-LearningSaturationUI-cs"><a href="#Code-Patch-LearningSaturationUI-cs" class="headerlink" title="Code: Patch_LearningSaturationUI.cs"></a>Code: Patch_LearningSaturationUI.cs</h2><p>依葫芦画瓢，添加 UI 信息。主要是把原来的信息替换成新的</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">HarmonyPatch(typeof(SkillUI))</span>]</span><br><span class="line">[<span class="meta">HarmonyPatch(<span class="meta-string">&quot;GetSkillDescription&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title">Patch_LearningSaturationUI</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Postfix</span>(<span class="params"><span class="keyword">ref</span> <span class="built_in">string</span> __result, SkillRecord sk</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		StringBuilder stringRebuilder = <span class="keyword">new</span> StringBuilder(__result);</span><br><span class="line">		StringBuilder oldStringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">		<span class="keyword">if</span> (sk.LearningSaturatedToday)</span><br><span class="line">		&#123;</span><br><span class="line">			oldStringBuilder.AppendLine();</span><br><span class="line">			oldStringBuilder.Append(<span class="string">&quot;LearnedMaxToday&quot;</span>.Translate(</span><br><span class="line">				sk.xpSinceMidnight,</span><br><span class="line">				<span class="number">4000</span>,</span><br><span class="line">				<span class="number">0.2f</span>.ToStringPercent(<span class="string">&quot;F0&quot;</span>)</span><br><span class="line">			));</span><br><span class="line">		&#125;</span><br><span class="line">		oldStringBuilder.AppendLine();</span><br><span class="line">		oldStringBuilder.AppendLine();</span><br><span class="line">		oldStringBuilder.Append(sk.def.description);</span><br><span class="line">		StringBuilder newStringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">		<span class="keyword">if</span> (ModSettings.saturatedXPMultiplier != <span class="number">1.0f</span></span><br><span class="line">			&amp;&amp; sk.xpSinceMidnight &gt; ModSettings.dailyXPSaturationThreshold)</span><br><span class="line">		&#123;</span><br><span class="line">			newStringBuilder.AppendLine();</span><br><span class="line">			newStringBuilder.Append(<span class="string">&quot;LearnedMaxToday&quot;</span>.Translate(</span><br><span class="line">				sk.xpSinceMidnight,</span><br><span class="line">				Mathf.RoundToInt(ModSettings.dailyXPSaturationThreshold),</span><br><span class="line">				ModSettings.saturatedXPMultiplier.ToStringPercent(<span class="string">&quot;F0&quot;</span>)</span><br><span class="line">			));</span><br><span class="line">		&#125;</span><br><span class="line">		stringRebuilder.Replace(oldStringBuilder.ToString(), newStringBuilder.ToString());</span><br><span class="line">		stringRebuilder.AppendLine();</span><br><span class="line">		stringRebuilder.AppendLine();</span><br><span class="line">		stringRebuilder.Append(sk.def.description);</span><br><span class="line">		__result = stringRebuilder.ToString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Code-Patch-SkillRecordInterval-cs"><a href="#Code-Patch-SkillRecordInterval-cs" class="headerlink" title="Code: Patch_SkillRecordInterval.cs"></a>Code: Patch_SkillRecordInterval.cs</h2><p>最后一部分是对于 <code>Interval</code> 的修改。注意到这里使用 prefix 方法，返回 <code>false</code> 相当于直接替换了原来的方法。依葫芦画瓢把降低 50% 流失的功能也加上，可以看到这个数据没有出现在 XML 里面，果然是硬编码的</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">HarmonyPriority(Priority.HigherThanNormal)</span>]</span><br><span class="line">[<span class="meta">HarmonyPatch(typeof(SkillRecord))</span>]</span><br><span class="line">[<span class="meta">HarmonyPatch(<span class="meta-string">&quot;Interval&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title">Patch_SkillRecordInterval</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">static</span> FieldInfo pawnField = AccessTools.Field(<span class="keyword">typeof</span>(SkillRecord), <span class="string">&quot;pawn&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="built_in">bool</span> <span class="title">Prefix</span>(<span class="params">SkillRecord __instance</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!ModSettings.tiered || __instance.XpProgressPercent &gt; <span class="number">0.1f</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">float</span> greatMemMultiplier = (ModSettings.greatMemoryAltered || !(pawnField.GetValue(__instance) <span class="keyword">as</span> Pawn).story.traits.HasTrait(TraitDefOf.GreatMemory)) ? <span class="number">1f</span> : <span class="number">0.5f</span>;</span><br><span class="line">			<span class="built_in">float</span> xpToLearn = greatMemMultiplier * VanillaMultiplier(__instance.levelInt) * ModSettings.multiplier;</span><br><span class="line">			<span class="keyword">if</span> (xpToLearn != <span class="number">0.0f</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				__instance.Learn(xpToLearn, <span class="literal">false</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">float</span> <span class="title">VanillaMultiplier</span>(<span class="params"><span class="built_in">int</span> level</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">switch</span> (level)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">10</span>: <span class="keyword">return</span> <span class="number">-0.1f</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">11</span>: <span class="keyword">return</span> <span class="number">-0.2f</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">12</span>: <span class="keyword">return</span> <span class="number">-0.4f</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">13</span>: <span class="keyword">return</span> <span class="number">-0.6f</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">14</span>: <span class="keyword">return</span> <span class="number">-1.0f</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">15</span>: <span class="keyword">return</span> <span class="number">-1.8f</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">16</span>: <span class="keyword">return</span> <span class="number">-2.8f</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">17</span>: <span class="keyword">return</span> <span class="number">-4.0f</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">18</span>: <span class="keyword">return</span> <span class="number">-6.0f</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">19</span>: <span class="keyword">return</span> <span class="number">-8.0f</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">20</span>: <span class="keyword">return</span> <span class="number">-12.0f</span>;</span><br><span class="line">			<span class="literal">default</span>: <span class="keyword">return</span> <span class="number">0.0f</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h2><p>好了，基本大功告成了，剩下的就是各种测试了。（其实做到一半就应该各种测试了）。关于调试，也有很多技巧。Rimworld Modder 是非常幸运的，因为开发组对 Modder 真的很友好，Wiki 和 Forum 也很友好。之后还会有各种类似的 Modding 向导，有朝一日可能也会发布自己的 MOD。敬请期待</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/project/">项目</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/categories/">分类</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E7%AF%87%E9%97%B2%E6%89%AF"><span class="toc-number">1.</span> <span class="toc-text">开篇闲扯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%B2%E6%89%AF%EF%BC%88%E7%BB%AD%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">闲扯（续）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%B0%86%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BB%A3%E7%A0%81%E6%94%BE%E5%88%B0%E6%B8%B8%E6%88%8F%E4%B8%AD%EF%BC%9F"><span class="toc-number">3.</span> <span class="toc-text">如何将自己的代码放到游戏中？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Harmony"><span class="toc-number">3.1.</span> <span class="toc-text">Harmony</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3%E6%B8%B8%E6%88%8F%E7%9A%84%E4%BB%A3%E7%A0%81%E9%80%BB%E8%BE%91"><span class="toc-number">4.</span> <span class="toc-text">了解游戏的代码逻辑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-Mod-cs"><span class="toc-number">5.</span> <span class="toc-text">Code: Mod.cs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-ModSettings-cs"><span class="toc-number">6.</span> <span class="toc-text">Code: ModSettings.cs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-Patch-LearningSaturation-cs"><span class="toc-number">7.</span> <span class="toc-text">Code: Patch_LearningSaturation.cs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-Patch-LearningSaturationUI-cs"><span class="toc-number">8.</span> <span class="toc-text">Code: Patch_LearningSaturationUI.cs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-Patch-SkillRecordInterval-cs"><span class="toc-number">9.</span> <span class="toc-text">Code: Patch_SkillRecordInterval.cs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-End"><span class="toc-number">10.</span> <span class="toc-text">The End</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/&text=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/&title=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/&is_video=false&description=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)&body=Check out this article: https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/&title=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/&title=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/&title=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/&title=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/&name=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://weaverzhu.github.io/2020/01/27/rimworld-mod-codereading1/&t=Rimworld 环世界 Mod 代码解读之 Mad Skills (MOD 制作向导)"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021-2022
    Weave_zhu
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/project/">项目</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/categories/">分类</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>
